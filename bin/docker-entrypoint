#!/bin/bash -e

migrate-db() {
    echo "Updating migration"
    ./bin/rails db:rollback | echo "Error: Failed to rollback migration"
    ./bin/rails db:migrate  | echo "Error: Failed to migrate"
}

# If running the rails server then create or migrate existing database and update swagger documentation
echo "preparing db...."

./bin/rails db:create
./bin/rails db:prepare
update_swagger
migrate-db

# Monitor folder migration for changes and update db
echo "Monitoring migrate for changes..."
while true; do
    change=$(inotifywait -qq -e modify,move,create,delete -r ./db/migrate)
    echo "Change detected: $change"
    migrate-db
done &



# Execute additional commands
exec "${@}"



